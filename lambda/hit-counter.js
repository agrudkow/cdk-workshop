"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_sdk_1 = require("aws-sdk");
exports.handler = async (event) => {
    var _a;
    console.log('request', JSON.stringify(event, undefined, 2));
    const dynamoDBClient = new aws_sdk_1.DynamoDB();
    const lambdaClient = new aws_sdk_1.Lambda();
    await dynamoDBClient
        .updateItem({
        TableName: process.env.HITS_TABLE_NAME,
        Key: { path: { S: event.path } },
        UpdateExpression: 'ADD hits :incr',
        ExpressionAttributeValues: { ':incr': { N: '1' } },
    })
        .promise();
    const resp = await lambdaClient
        .invoke({
        FunctionName: process.env.DOWNSTREAM_FUNCTION_NAME,
        Payload: JSON.stringify(event),
    })
        .promise();
    console.log(`downstream response: `, JSON.stringify(resp, undefined, 2));
    return JSON.parse(((_a = resp.Payload) === null || _a === void 0 ? void 0 : _a.toString()) || '');
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGl0LWNvdW50ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJoaXQtY291bnRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxxQ0FBMkM7QUFFOUIsUUFBQSxPQUFPLEdBQTJCLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRTs7SUFDN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFNUQsTUFBTSxjQUFjLEdBQUcsSUFBSSxrQkFBUSxFQUFFLENBQUM7SUFDdEMsTUFBTSxZQUFZLEdBQUcsSUFBSSxnQkFBTSxFQUFFLENBQUM7SUFFbEMsTUFBTSxjQUFjO1NBQ2pCLFVBQVUsQ0FBQztRQUNWLFNBQVMsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQXlCO1FBQ2hELEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFFLEVBQUU7UUFDaEMsZ0JBQWdCLEVBQUUsZ0JBQWdCO1FBQ2xDLHlCQUF5QixFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFO0tBQ25ELENBQUM7U0FDRCxPQUFPLEVBQUUsQ0FBQztJQUViLE1BQU0sSUFBSSxHQUFHLE1BQU0sWUFBWTtTQUM1QixNQUFNLENBQUM7UUFDTixZQUFZLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBa0M7UUFDNUQsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO0tBQy9CLENBQUM7U0FDRCxPQUFPLEVBQUUsQ0FBQztJQUViLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFekUsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQUEsSUFBSSxDQUFDLE9BQU8sMENBQUUsUUFBUSxPQUFNLEVBQUUsQ0FBQyxDQUFDO0FBQ3BELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUhhbmRsZXIgfSBmcm9tICdhd3MtbGFtYmRhJztcbmltcG9ydCB7IExhbWJkYSwgRHluYW1vREIgfSBmcm9tICdhd3Mtc2RrJztcblxuZXhwb3J0IGNvbnN0IGhhbmRsZXI6IEFQSUdhdGV3YXlQcm94eUhhbmRsZXIgPSBhc3luYyAoZXZlbnQpID0+IHtcbiAgY29uc29sZS5sb2coJ3JlcXVlc3QnLCBKU09OLnN0cmluZ2lmeShldmVudCwgdW5kZWZpbmVkLCAyKSk7XG5cbiAgY29uc3QgZHluYW1vREJDbGllbnQgPSBuZXcgRHluYW1vREIoKTtcbiAgY29uc3QgbGFtYmRhQ2xpZW50ID0gbmV3IExhbWJkYSgpO1xuXG4gIGF3YWl0IGR5bmFtb0RCQ2xpZW50XG4gICAgLnVwZGF0ZUl0ZW0oe1xuICAgICAgVGFibGVOYW1lOiBwcm9jZXNzLmVudi5ISVRTX1RBQkxFX05BTUUgYXMgc3RyaW5nLFxuICAgICAgS2V5OiB7IHBhdGg6IHsgUzogZXZlbnQucGF0aCB9IH0sXG4gICAgICBVcGRhdGVFeHByZXNzaW9uOiAnQUREIGhpdHMgOmluY3InLFxuICAgICAgRXhwcmVzc2lvbkF0dHJpYnV0ZVZhbHVlczogeyAnOmluY3InOiB7IE46ICcxJyB9IH0sXG4gICAgfSlcbiAgICAucHJvbWlzZSgpO1xuXG4gIGNvbnN0IHJlc3AgPSBhd2FpdCBsYW1iZGFDbGllbnRcbiAgICAuaW52b2tlKHtcbiAgICAgIEZ1bmN0aW9uTmFtZTogcHJvY2Vzcy5lbnYuRE9XTlNUUkVBTV9GVU5DVElPTl9OQU1FIGFzIHN0cmluZyxcbiAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KGV2ZW50KSxcbiAgICB9KVxuICAgIC5wcm9taXNlKCk7XG5cbiAgY29uc29sZS5sb2coYGRvd25zdHJlYW0gcmVzcG9uc2U6IGAsIEpTT04uc3RyaW5naWZ5KHJlc3AsIHVuZGVmaW5lZCwgMikpO1xuXG4gIHJldHVybiBKU09OLnBhcnNlKHJlc3AuUGF5bG9hZD8udG9TdHJpbmcoKSB8fCAnJyk7XG59O1xuIl19